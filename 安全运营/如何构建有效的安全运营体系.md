# 0x01 安全运营

## 1.1 什么是安全运营

为了收敛或根除安全问题，分析问题、诊断问题、提出安全解决方案、验证效果，协调资源解决问题，并持续迭代优化的过程

## 1.2 安全运营目标

* 稳定和提升安全服务质量

企业部署大量的安全防护设备和措施，提升安全检测能力的同时，如何解决安全设备有效性的问题？安全设备梳理和安全日志告警剧增，如何确保安全人员工作质量的稳定输出？

* 提升安全工程化能力

如何将工程师个人安全能力转为自动化的安全检测能力，并通过安全平台进行应急响应和处理

## 1.3安全运营有哪些内容

* Find and Fix： 发现安全问题（漏洞扫描、渗透测试、代码审计等），设计和实施安全方案解决问题

* Defend and Defer：安全监控与告警（IPS、WAF、蜜罐、HIDS反DDOS设备等）

* Secure at the Source：安全开发流程（SDL）

三者互补，当SDL出现差错时，可以通过周期性的扫描、安全评估等工作将问题解决；入侵检测、WAD等系统，可以在安全事件发生后进行响应，事后止损。

![Accelera-Devsecops | Collaboration for Digital Dexterity](https://www.minfytech.com/wp-content/uploads/2021/05/DevSecOps-Solution.png)



## 1.4 安全运营建设思路

### 1.4.1 架构

* 安全防护框架：**纵深防御**，部署安全检测系统，提升实时防护和检测能力

![深圳市联软科技股份有限公司](https://www.leagsoft.com/upload/image/2006/2006010223199.png)

* 安全运维框架：统一采集安全防护框架的监测信息，并通过黑白灰名单处理和关联分析，统一展示和输出告警，进入事件处理平台和流程，人工介入处理。**安全事件定期review和向管理层汇报**

参考美军的C4ISR作战指挥系统（指挥、控制、通信、计算机与情报、监视、侦察）

1.基础架构平台（大脑）：指挥自动化系统，容量大、速度快、兼容性强

2.安全情报、安全监视、侦察系统（耳目）：对安全防护框架中的安全信息进行收集和处理

3.数据分析系统（神经中枢）：运用智能分析算法和数据挖掘分析技术，实现安全信息自动化处理

4.安全控制系统（手脚）：实施指挥系统下发的安全控制命令

* 安全验证框架：通过黑盒白盒验证确保安全防护和运维框架的有效性

白盒检测（过程验证）：建立自动化验证平台，对安全防护框架管控措施进行100%全面验证，并可视化集成到安全运维平台。

> 验证安全Sensor安全监测功能有效；

> 验证安全Sensor所产生监测信息到SIEM平台的信息采集有效；

> 验证SIEM平台的安全检测规则有效；

> 验证告警方式（邮件、短信与可视化 展示平台）有效

黑盒检测（结果验证）是通过多渠道安全渗透机制和红蓝对抗演习等，先于对手发现自己的漏洞和弱点。多渠道安全渗透机制目前常见的就是安全众测，红蓝对抗演习需要企业具有较高攻防技能的安全人员，也可外聘外部专业机构完成，用于检测安全防护框架和安全运维框架的有效性。

* 安全度量框架：输出一系列安全度量指标，评估安全运营质量水平，并针对性持续改进，提升质量

#### 1.4.1.1 技术维度：

* 防病毒安装率、正常率
* 入侵检测检出率、误报率
* 安全事件响应时长、处理时长
* 高危预警漏洞排查所需时间和完全修复时间

#### 1.4.1.2 安全运营成效

* 覆盖率、检出率、攻防对抗成功率
* 有多少业务和系统处于安全保护之下

#### 1.4.1.3 安全满意度和安全价值

* 安全价值反映在安全对业务支撑的能力，TCO/ROI，安全用多少资源，支撑了多少业务，支撑的程度
* 内部的影响力以及对业务的影响力
* 安全满意度是综合维度指标，是对安全团队和人员的最高要求，既要满足上级领导和业务部门对安全的利益诉求，又要满足同级横向其他IT团队对安全的利益诉求，还要满足团队内部成员的利益诉求。

### 1.4.2 工具

安全运营工具包括支撑安全运维框架实现的SIEM平台、安全事件处理标准化流程工具ITIL、安全控制自动化工具三部分：

- SIEM平台负责安全信息的统一收集和存储、基于检测规则的异常检测和告警

1. 单一检测条件和规则：满足单一条件出发告警，Ayazero在《互联网企业高级安全》中提到的检测攻击提权，“某个高权限（system?uid=0）进程（bash?cmd.exe?）的父进程为低权限
2. 跨平台安全监测信息关联检测：最典型的规则为基于资产脆弱性的攻击告警，关联分析漏洞扫描和入侵检测告警信息进行关联检测。比如防火墙permit日志中有连接ArcOSI中定义的恶意IP地址信息。
3. 针对长时间缓慢低频度攻击的检测规则：在较长时间内搜索特定事件，并在该事件范围内发生次数达到某个阈值时告警

- ITIL平台负责接收SIEM平台发送过来的安全事件信息并据此产生ITIL工单，推送到安全运营人员处理和关闭。
- 安全控制自动化工具负责根据SIEM平台下发的安全控制指令进行自动化操作，例如，检测发现有外部攻击源，通过下发自动化指令实现防火墙或IPS封禁该攻击源；检测发现某主机有可疑进程，通过安全客户端收集该进程文件样本信息进一步手动分析；检测发现办公内网某用户计算机上有个可疑操作非人工操作，疑似程序自动操作，可通过安全客户端提示用户手工确认等。

1. 控制指令仅允许固化的指令，严禁在Sensor端预留执行系统命令接口
2. 控制指令下发时必须人工审核确认后才执行

### 1.4.3 所需资源

#### 1.4.3.1 流程与机制 

* 安全事件处理流程：定义什么级别的事件该由什么样的人，在什么时间按什么标准处理完成

* 安全运营持续改进流程：安全事件的闭环管理，每笔安全事件的处理结果最终必须为误报或者属实，二者必选其一

#### 1.4.3.2 组织与人员

证券公司安全运营人员建议按1:2:3比例配置。即一个安全运营平台运维人员，包括服务器和应用运维，该部分可以交给IT部门的运维团队代为运维。2个安全人员互备，一个负责安全Sensor建设，一个负责安全检测规则和安全二线，事件调查、回顾与汇报、持续改进。3个外包安全一线，负责7*12事件响应和初步调查确认。

股份制银行安全运营人员推荐配置为证券公司的2-3倍，外包人员还可视事件类型和数量增加。

## 1.5 安全运营思考

### 1.5.1 难点

* 企业自身基础设施成熟度不高
* 长期严格执行安全运营流程比较难（人员方面）
* 一是没有特别好的商业化工具，能够结合企业内部的流程和人员，提高安全运营效率
* 是一万个安全负责人心中有一万个安全运营，打法思路各异，没有形成统一的安全运营标准

### 1.5.2 安全检测为什么失效

排查顺序：单点检测深度不足->覆盖率不足->安全运维平台可用性出了问题->告警质量问题->人的问题

首先是单点检测手段不足导致，可能是检测的正则表达式写的不好，或者是攻击者使用的方式没有预先考虑到，也可能现有的安全防护框架的安全监测根本就监测不到。针对性的改进提升就可以了。



第二是覆盖率不足导致。出现问题的机器或网络区域就没有部署安全监测产品，即使有监测能力，也会因为没有部署而导致检测失效。比如防病毒客户端安装率和正常率只有80%，那即使针对已知恶意程序，也只有不超过80%的概率能够监测发现。

所以这个问题的根本解决方案，就是把部署率、正常率提升上去。关于企业安全灰色地带，有几个值得关注的地方：

（1）无人关注的资产，特别是互联网资产。漏洞通报平台报出的很多安全漏洞，得到的企业回复很多是：这是一台（测试/即将下线/无人使用/外包人员使用……）的设备，我们已关闭。这些资产除了服务器，还分配了的互联网IP、域名，不在安全监测里的系统和应用；

（2）开放在互联网上的管理后台、高危端口、文件上传点；

（3）各种已被爆漏洞的第三方应用；

（4）弱口令，包括系统弱口令、应用弱口令、用户弱口令等各种弱口令，如果解决好了口令的问题，保守估计可以解决企业50%的安全问题。



第三是安全运维平台可用性出了问题：

- 安全检测信息采集器失效的原因主要是未对采集器的物理机器性能监控、采集数据正常监控、采集数据日志解析和映射入库（Parser）异常等。
- SIEM检测规则失效包括设定条件无效、阈值无效、规则未生效等，有时告警阈值设置不合理频繁告警，SIEM平台会自动禁用规则导致规则无效。
- 安全告警失效，包括邮件、短信网关配置无效，配置用户失效、网络失效、配置变更异常、手机号码设置错误等等。
- 安全告警处理失效主要是人的因素，比如多条告警短信，选择性的忽略，假阳性告警太多淹没了真正有威胁告警等。

第四是告警质量的问题。SOC被诟病最多的是采集了大量数据，但往往不能判断哪些是真正需要关注的告警。告警有效性较低，导致大量需要人工确认，管理成本太高。安全检测规则的设计不足导致告警数量太多，从而导致安全运营人员选择性的忽略。



第五是人的问题。机制流程也可以理解为是人的问题。如果前述原因排除，还是有安全检测失效的问题，那应归结于人的问题。比如人的责任心问题，快到下班时间了，匆匆把告警确认关闭敷衍了事；或者人的安全技能不足，不能有效调查判断实际安全问题。

### 1.5.3 安全运营成熟度

（1）一级：自发级。部署了一些较为基础的安全措施和管控，单点防御投入了较多人力财力，比较依赖于厂商，对于企业安全没有整体把控。 

（2）二级：基础级。具有安全运营的理念并付诸行动，建立了较为完善的安全防护体系，并通过安全运营保障安全有效性，具有攻防能力的个人或团队，能够解决实际安全问题。

（3）三级：自动化级。具有自动化监测、响应、处理甚至反击能力，对企业自身安全现状和能力具有全局掌控力，具有入侵感知能力，能进行一定级别的攻防对抗。

（4）四级：智能级。采用了白名单的安全防护原则，具有真正意义的智能安全检测，能够对偏离正常行为模式的行为进行识别。

（5）五级：天网级。天网恢恢疏而不漏，让所有恶意行为无所遁形。这级别的安全，出于一个理想状态，目前为止还没有真实案例。

# 0x02 企业安全的发展方向

* 第一个目标：让工程师写出的每一行代码都是安全的

* 第二个目标：让所有已知的、未知的攻击，都能在第一时间发现，并迅速报警和追踪

* 第三个目标：让安全成为公司的核心竞争力，深入到每一个产品的特性中，更好的引导用户使用互联网的习惯

* 第四个目标：能够观测到整个互联网安全趋势的变化，对未来一段时间内的风险做出预警